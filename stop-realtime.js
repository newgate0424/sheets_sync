// stop-realtime.js - ‡∏´‡∏¢‡∏∏‡∏î Real-time Sync ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥ Full Sync
require('dotenv').config({ path: '.env.local' });

async function stopAndFullSync() {
  try {
    console.log('üî¥ Stopping all Real-time Sync and doing Full Sync...\n');

    // ‡∏ó‡∏≥ Full Sync All
    const fullSyncResponse = await fetch('http://localhost:3001/api/sync/all', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ 
        fullSync: true 
      })
    });

    if (!fullSyncResponse.ok) {
      throw new Error(`Full sync failed: ${fullSyncResponse.status}`);
    }

    const result = await fullSyncResponse.json();
    
    console.log('‚úÖ Full Sync All Result:');
    console.log(`üìä Total Configs: ${result.totalConfigs}`);
    console.log(`‚úÖ Success Count: ${result.successCount}`);
    console.log(`‚ùå Fail Count: ${result.failCount}`);
    console.log(`üìà Total Rows Synced: ${result.totalRowsSynced}`);
    console.log(`üîß Sync Type: ${result.syncType}`);
    console.log(`üí¨ Message: ${result.message}\n`);

    if (result.results && result.results.length > 0) {
      console.log('üìã Individual Results:');
      result.results.forEach((res, i) => {
        console.log(`  ${i + 1}. ${res.configName}:`);
        console.log(`     Status: ${res.success ? '‚úÖ Success' : '‚ùå Failed'}`);
        console.log(`     Rows: ${res.rowsSynced}`);
        console.log(`     Type: ${res.syncType}`);
        if (res.error) console.log(`     Error: ${res.error}`);
        console.log('');
      });
    }

    console.log('üéØ Full Sync completed! Database should now exactly match Google Sheets.');

  } catch (error) {
    console.error('‚ùå Error in full sync:', error);
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
stopAndFullSync().catch(console.error);
